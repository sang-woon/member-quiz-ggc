# TRD (기술 요구사항 정의서)

> 의원얼굴퀴즈 - 개발자/AI 코딩 파트너용 기술 문서

---

## MVP 캡슐

| # | 항목 | 내용 |
|---|------|------|
| 1 | 목표 | 경기도의회 직원이 의원 얼굴과 이름을 쉽고 재미있게 학습 |
| 2 | 페르소나 | 경기도의회 사무처 직원 (특히 신규 입사자) |
| 3 | 핵심 기능 | FEAT-1: 얼굴 보고 이름 맞추기 퀴즈 |
| 4 | 성공 지표 (노스스타) | 사용자가 전체 의원 정답률 80% 이상 달성 |
| 5 | 입력 지표 | 퀴즈 완료 횟수, 일일 활성 사용자 |
| 6 | 비기능 요구 | 모바일/PC 반응형 지원 |
| 7 | Out-of-scope | 로그인/회원가입, 학습 진도 저장, 랭킹 시스템 |
| 8 | Top 리스크 | 의원 사진 데이터 확보 및 최신 유지 |
| 9 | 완화/실험 | 경기도의회 공식 홈페이지 데이터 활용 |
| 10 | 다음 단계 | 의원 데이터 수집 및 정리 |

---

## 1. 시스템 아키텍처

### 1.1 고수준 아키텍처

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Client    │────▶│   Server    │────▶│  Database   │
│ React+Vite  │     │  FastAPI    │     │   SQLite    │
└─────────────┘     └─────────────┘     └─────────────┘
       │                   │
       │                   │
       ▼                   ▼
┌─────────────┐     ┌─────────────┐
│   Static    │     │   Images    │
│   Assets    │     │  (의원사진) │
└─────────────┘     └─────────────┘
```

### 1.2 컴포넌트 설명

| 컴포넌트 | 역할 | 왜 이 선택? |
|----------|------|-------------|
| Frontend (React+Vite) | 퀴즈 UI, 사용자 인터랙션 | 듀오링고 스타일 인터랙티브 UI 구현 용이 |
| Backend (FastAPI) | 의원 데이터 API, 퀴즈 로직 | 가볍고 빠른 개발, SQLite 궁합 좋음 |
| Database (SQLite) | 의원 정보 저장 | 별도 설치 없이 파일 하나로 관리 |
| Static Images | 의원 사진 저장 | 서버에서 직접 서빙 |

---

## 2. 권장 기술 스택

### 2.1 프론트엔드

| 항목 | 선택 | 이유 | 벤더 락인 리스크 |
|------|------|------|-----------------|
| 프레임워크 | React 18+ | 풍부한 생태계, 애니메이션 라이브러리 다양 | 낮음 |
| 빌드 도구 | Vite | 빠른 개발 서버, HMR 지원 | 낮음 |
| 언어 | TypeScript | 타입 안정성, 개발 생산성 | - |
| 스타일링 | TailwindCSS | 유틸리티 우선, 빠른 스타일링 | 낮음 |
| 상태관리 | React useState/useReducer | 간단한 앱이라 별도 라이브러리 불필요 | 낮음 |
| HTTP 클라이언트 | fetch (내장) | 별도 설치 불필요, 충분한 기능 | 낮음 |
| 애니메이션 | Framer Motion | 듀오링고 스타일 애니메이션 | 낮음 |

### 2.2 백엔드

| 항목 | 선택 | 이유 | 벤더 락인 리스크 |
|------|------|------|-----------------|
| 프레임워크 | FastAPI | 빠른 개발, 자동 API 문서 | 낮음 |
| 언어 | Python 3.11+ | 읽기 쉬운 코드, 풍부한 라이브러리 | - |
| ORM | SQLAlchemy 2.0 | SQLite 호환, 타입 힌트 지원 | 낮음 |
| 검증 | Pydantic v2 | FastAPI 내장, 자동 검증 | 낮음 |

### 2.3 데이터베이스

| 항목 | 선택 | 이유 |
|------|------|------|
| 메인 DB | SQLite | 파일 기반, 설치 불필요, 약 150명 의원 데이터에 충분 |
| 캐시 | 불필요 | 데이터 크기가 작아 캐시 불필요 |

### 2.4 인프라

| 항목 | 선택 | 이유 |
|------|------|------|
| 개발 환경 | Docker Compose | 로컬 개발 일관성 (선택적) |
| 호스팅 | 추후 결정 | 내부 서버 또는 Vercel/Railway |

---

## 3. 비기능 요구사항

### 3.1 성능

| 항목 | 요구사항 | 측정 방법 |
|------|----------|----------|
| 응답 시간 | < 200ms | API 응답 시간 |
| 초기 로딩 | < 2s (FCP) | Lighthouse |
| 이미지 로딩 | 지연 로딩 적용 | 체감 성능 |

### 3.2 보안

| 항목 | 요구사항 |
|------|----------|
| 인증 | 없음 (로그인 불필요) |
| HTTPS | 배포 시 필수 |
| 입력 검증 | 서버 측 필터 파라미터 검증 |
| CORS | 프론트엔드 도메인만 허용 |

### 3.3 확장성

| 항목 | 현재 | 목표 |
|------|------|------|
| 동시 사용자 | MVP: 10명 | v2: 50명 |
| 의원 데이터 | 약 150명 | 타 지방의회 확장 시 증가 |

---

## 4. 외부 API 연동

### 4.1 인증
- 없음 (로그인 불필요)

### 4.2 기타 서비스

| 서비스 | 용도 | 필수/선택 | 비고 |
|--------|------|----------|------|
| 없음 | - | - | MVP에서는 외부 연동 없음 |

---

## 5. 접근제어/권한 모델

### 5.1 역할 정의

| 역할 | 설명 | 권한 |
|------|------|------|
| 사용자 | 모든 방문자 | 퀴즈 풀기, 필터링 |
| 관리자 | 데이터 관리 (v2) | 의원 데이터 CRUD |

### 5.2 권한 매트릭스

| 리소스 | 사용자 | 관리자 (v2) |
|--------|-------|-------------|
| 퀴즈 풀기 | O | O |
| 의원 목록 조회 | O | O |
| 의원 정보 수정 | - | O |

---

## 6. 데이터 생명주기

### 6.1 원칙

- **최소 수집**: 사용자 개인정보 수집 안 함 (로그인 없음)
- **공개 데이터**: 의원 정보는 공개 정보
- **정적 데이터**: 의원 임기 중 거의 변경 없음

### 6.2 데이터 흐름

```
의원 정보 입력 → SQLite 저장 → API 조회 → 프론트엔드 표시
```

| 데이터 유형 | 보존 기간 | 삭제/익명화 |
|------------|----------|------------|
| 의원 정보 | 임기 종료까지 | 임기 종료 후 아카이브 |
| 의원 사진 | 임기 종료까지 | 임기 종료 후 삭제 또는 교체 |

---

## 7. 테스트 전략 (Contract-First TDD)

### 7.1 개발 방식: Contract-First Development

본 프로젝트는 **계약 우선 개발(Contract-First Development)** 방식을 채택합니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    Contract-First 흐름                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 계약 정의 (Phase 0)                                     │
│     ├─ API 계약: contracts/*.contract.ts                   │
│     ├─ BE 스키마: backend/app/schemas/*.py                 │
│     └─ 타입 동기화: TypeScript ↔ Pydantic                  │
│                                                             │
│  2. 테스트 선행 작성 (RED)                                  │
│     ├─ BE 테스트: tests/api/*.py                           │
│     ├─ FE 테스트: src/__tests__/**/*.test.ts               │
│     └─ 모든 테스트가 실패하는 상태 (정상!)                  │
│                                                             │
│  3. Mock 생성 (FE 독립 개발용)                              │
│     └─ MSW 핸들러: src/mocks/handlers/*.ts                 │
│                                                             │
│  4. 병렬 구현 (RED→GREEN)                                   │
│     ├─ BE: 테스트 통과 목표로 구현                          │
│     └─ FE: Mock API로 개발 → 나중에 실제 API 연결          │
│                                                             │
│  5. 통합 검증                                               │
│     └─ Mock 제거 → E2E 테스트                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 테스트 피라미드

| 레벨 | 도구 | 커버리지 목표 | 위치 |
|------|------|-------------|------|
| Unit | pytest / Vitest | ≥ 80% | tests/unit/, src/__tests__/ |
| Integration | pytest / Vitest + MSW | Critical paths | tests/integration/ |
| E2E | Playwright | Key user flows | e2e/ |

### 7.3 테스트 도구

**백엔드:**
| 도구 | 용도 |
|------|------|
| pytest | 테스트 실행 |
| pytest-asyncio | 비동기 테스트 |
| httpx | API 클라이언트 |
| pytest-cov | 커버리지 측정 |

**프론트엔드:**
| 도구 | 용도 |
|------|------|
| Vitest | 테스트 실행 |
| React Testing Library | 컴포넌트 테스트 |
| MSW (Mock Service Worker) | API 모킹 |
| Playwright | E2E 테스트 |

### 7.4 TDD 사이클

```
RED    → 실패하는 테스트 먼저 작성
GREEN  → 테스트를 통과하는 최소한의 코드 구현
REFACTOR → 테스트 통과 유지하며 코드 개선
```

### 7.5 품질 게이트

**병합 전 필수 통과:**
- [ ] 모든 단위 테스트 통과
- [ ] 커버리지 ≥ 80%
- [ ] 린트 통과 (ruff / ESLint)
- [ ] 타입 체크 통과 (mypy / tsc)

---

## 8. API 설계 원칙

### 8.1 RESTful 규칙

| 메서드 | 용도 | 예시 |
|--------|------|------|
| GET | 조회 | GET /api/members |
| GET | 상세 조회 | GET /api/members/{id} |
| GET | 퀴즈 문제 | GET /api/quiz |

### 8.2 주요 API 엔드포인트

| 엔드포인트 | 메서드 | 설명 |
|-----------|--------|------|
| `/api/members` | GET | 의원 목록 조회 (필터링 지원) |
| `/api/members/{id}` | GET | 의원 상세 정보 |
| `/api/quiz` | GET | 퀴즈 문제 생성 (랜덤 4지선다) |
| `/api/districts` | GET | 지역구 목록 |
| `/api/committees` | GET | 위원회 목록 |

### 8.3 응답 형식

**성공 응답:**
```json
{
  "data": { ... },
  "meta": {
    "total": 150
  }
}
```

**에러 응답:**
```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "의원 정보를 찾을 수 없습니다."
  }
}
```

### 8.4 API 버저닝

| 방식 | 예시 | 채택 여부 |
|------|------|----------|
| URL 경로 | /api/v1/members | MVP에서는 버저닝 없이 /api/ 사용 |

---

## 9. 병렬 개발 지원 (Git Worktree)

### 9.1 개요

BE/FE를 완전히 독립된 환경에서 병렬 개발할 때 Git Worktree를 사용합니다.

### 9.2 Worktree 구조

```
~/projects/
├── member-quiz/              # 메인 (main 브랜치)
├── member-quiz-api/          # Worktree: feature/api
└── member-quiz-ui/           # Worktree: feature/ui
```

### 9.3 병합 규칙

| 조건 | 병합 가능 |
|------|----------|
| 단위 테스트 통과 | 필수 |
| 커버리지 ≥ 80% | 필수 |
| 린트/타입 체크 통과 | 필수 |

---

## Decision Log 참조

| 결정 | 이유 |
|------|------|
| FastAPI 선택 | SQLite와 궁합 좋음, 빠른 개발 |
| React + Vite 선택 | 듀오링고 스타일 UI 구현 용이 |
| SQLite 선택 | 약 150명 데이터에 충분, 설정 간편 |
| 로그인 없음 | 진입 장벽 최소화 |
| TailwindCSS | 빠른 스타일링, 반응형 용이 |
